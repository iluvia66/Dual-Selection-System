{% extends "admin_base.html" %}

{% block content %}
    <h1>志愿匹配管理</h1>
    
    <!-- 匹配按钮 -->
    <form action="{{ url_for('admin_matching.run_matching') }}" method="POST">
        <button type="submit">开始匹配</button>
    </form>

    <!-- 显示临时表数据 -->
    <h2>临时表数据</h2>
    <table border="1">
        <tr>
            <th>学号</th>
            <th>导师id</th>
            <th>志愿级别</th>
            <th>匹配状态</th>
            <th>匹配时间</th>
        </tr>
        {% for record in temp_data %}
        <tr>
            <td>{{ record.candidate_id }}</td>
            <td>{{ record.advisor_id }}</td>
            <td>{{ record.preference_order }}</td>
            <td>{{ record.status }}</td>
            <td>{{ record.created_at }}</td>
        </tr>
        {% endfor %}
    </table>

    <!-- 匹配结果 -->
    {% if matched_data %}
    <h2>匹配结果</h2>
    <table border="1">
        <tr>
            <th>Candidate ID</th>
            <th>Candidate Name</th>
            <th>Advisor ID</th>
            <th>Advisor Name</th>
            <th>Subject Direction</th>
            <th>Department</th>
            <th>Match Date</th>
        </tr>
        {% for match in matched_data %}
        <tr>
            <td>{{ match.candidate_id }}</td>
            <td>{{ match.candidate_name }}</td>
            <td>{{ match.advisor_id }}</td>
            <td>{{ match.advisor_name }}</td>
            <td>{{ match.subject_name }}</td>
            <td>{{ match.department }}</td>
            <td>{{ match.match_date }}</td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}

    <!-- 下载 CSV 按钮 -->
    <form action="{{ url_for('admin_matching.export_matching') }}" method="GET">
        <button type="submit">下载匹配结果</button>
    </form>
{% endblock %}