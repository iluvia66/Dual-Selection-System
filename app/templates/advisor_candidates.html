{% extends "advisor_base.html" %}

{% block content %}
    <h1>选择您的学生名单 {{ advisor_info.advisor_name }}</h1>

    <p>
        已选择: {{ advisor_info.selected_count }} / 最大选择数: {{ advisor_info.annual_quota }}
    </p>

    <table border="1">
        <tr>
            <th>学号</th>
            <th>姓名</th>
            <th>Email邮箱</th>
            <th>联系电话</th>
            <th>志愿</th>
            <!-- <th>匹配状态</th> -->
            <!-- <th>匹配时间</th> -->
            <th>选择</th>
        </tr>
        {% for candidate in candidates %}
        <tr>
            <td>{{ candidate.candidate_id }}</td>
            <td>{{ candidate.candidate_name }}</td>
            <td>{{ candidate.candidate_email }}</td>
            <td>{{ candidate.candidate_phone }}</td>
            <td>{{ candidate.preference_order }}</td>
            <!-- <td>{{ candidate.status }}</td>
            <td>{{ candidate.match_date }}</td> -->
            <td>
                <form action="{{ url_for('task_line3.toggle_selection', advisor_id=candidate.advisor_id, candidate_id=candidate.candidate_id) }}" method="POST">
                    <input type="hidden" name="preference_order" value="{{ candidate.preference_order }}">
                    {% if candidate.selected %}
                        <input type="hidden" name="action" value="remove">
                        <button type="submit">Remove</button>
                    {% else %}
                        {% if advisor_info.selected_count < advisor_info.annual_quota %}
                            <input type="hidden" name="action" value="select">
                            <button type="submit">Select</button>
                        {% else %}
                            <button type="button" disabled>Limit Reached</button>
                        {% endif %}
                    {% endif %}
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
{% endblock %}
